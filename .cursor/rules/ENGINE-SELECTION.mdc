# Engine Selection

Quick check before executing. If wrong engine → tell user to switch, don't proceed.

## Fast Decision (5 seconds)

Scan request for these signals:

| Signal | Engine |
|--------|--------|
| "what is", "where is", grep, lookup, 1-2 files | **Haiku** ✓ |
| "fix bug", single edit, clear scope | **Haiku** ✓ |
| Add feature, implement, 3-5 files | **Sonnet** |
| Refactor, debug across files, review PR | **Sonnet** |
| "audit", "architecture", "security", "redesign" | **Opus** |
| Vague scope + complex domain | **Opus** |
| 10+ files or >500 LOC expected | **Opus** |

## Escalation Triggers

**→ Sonnet** if any:
- Need to trace logic across 3+ files
- Expected output >150 lines
- "Why does X happen?" requiring cross-file analysis

**→ Opus** if any:
- "Audit", "review all", "security"
- Vague scope + uncertain approach
- Multi-system integration
- Novel problem (no clear pattern to follow)
- User explicitly wants quality over speed

## Stay on Haiku

- Question answerable from 1-2 files
- Single-file edit with clear diff
- Running commands, reading output
- Config/rule changes (like this one)
- Quick code lookup or grep

## Stop Format

If wrong engine, say exactly:

> ⚡ Switch to **[SONNET/OPUS]**: [1 reason]. Then re-send.

Then STOP. No partial work.

## Cost Math

| Model | Speed | $/1M tokens | Best ROI |
|-------|-------|-------------|----------|
| Haiku | Fast | $ | Simple bounded tasks |
| Sonnet | Med | $$ | Most dev work |
| Opus | Slow | $$$$ | Complex/unbounded |

**Rule**: Use cheapest model that won't fail. Haiku failing = wasted tokens. Opus on simple = overspend.
