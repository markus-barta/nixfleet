# Engine Selection Rule

## Overview
Before executing ANY command or task, perform a quick self-evaluation to determine if the current engine is appropriate. If a different model would be significantly more suitable, **STOP and inform the user to switch models FIRST**—do NOT proceed with execution on the wrong engine.

## Model Selection Criteria

### Haiku (claude-4.5-haiku-thinking)
**Best for:**
- Simple, straightforward questions
- Quick lookups and grep searches
- Minor edits or single-file changes
- Fast decision-making with clear context
- Tasks with minimal reasoning complexity

**Avoid for:**
- Complex architectural decisions
- Deep codebase analysis requiring navigation across many files
- Substantial code generation (>100-200 lines)
- Debugging intricate logic flows
- Large refactoring efforts

### Sonnet (claude-3.5-sonnet)
**Best for:**
- Standard development tasks (most common)
- Medium complexity refactoring
- Feature implementation (100-500 lines)
- Code reviews and analysis
- Most debugging scenarios
- Balanced reasoning and speed

**Default choice** for most NixFleet development work.

### Opus (claude-3-opus)
**Best for:**
- Complex architectural decisions
- Deep codebase analysis requiring holistic understanding
- Large-scale refactoring (>500 lines, multiple files)
- Tricky debugging scenarios
- Security audits or comprehensive code reviews
- Novel problem-solving
- Generating comprehensive documentation

## Decision Flow

When you receive a task:

1. **Identify task complexity**: Is this simple, medium, or complex?
2. **Estimate scope**: How many files? How many lines of code?
3. **Assess reasoning needs**: Does this need deep analysis or is it straightforward?
4. **Self-evaluate**: Is my current engine (Haiku) a good fit?

## When to STOP and Ask for Engine Switch

**STOP execution and inform the user if:**

- Task requires deep architectural analysis or large codebase navigation
- Substantial code generation is needed (>200 lines)
- Complex debugging across multiple interconnected systems
- Comprehensive security or quality audit
- Problem-solving that requires extensive reasoning chains
- The task is clearly beyond Haiku's optimal performance window

**Format your response like this:**

> This task would be better served by **[MODEL]** because [brief reason]. Please switch your engine and I'll complete the task with proper context and capability.

Then STOP—do not proceed with the current (Haiku) engine.

## NixFleet-Specific Guidance

For this project:
- Dashboard template work (substantial): Often Sonnet or Opus
- Simple bug fixes: Haiku is fine
- Complex agent behavior or state management: Sonnet minimum, Opus for deep issues
- Integration between agent/dashboard: Sonnet minimum
- Security-related changes: Opus preferred
- Test writing: Sonnet or Haiku depending on complexity
- Documentation: Haiku is usually fine

## Important Notes

- This rule takes precedence over speed/efficiency concerns
- Better to pause and switch than to deliver suboptimal results
- Users appreciate transparency about model limitations
- Include the brief reason so the user understands the reasoning
